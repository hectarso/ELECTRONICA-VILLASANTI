<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>ELECTRONICA VILLASANTI | Cajas</title>
        <link rel="icon" type="image/png" href="../../../favicon.png"/>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="../../../css/bootstrap-theme.min.css" rel="stylesheet" type="text/css"/>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <link href="../../../css/estilos.css" rel="stylesheet" type="text/css"/>

    </head>
    <body background="../../../img/fondo.jpg">
        <div id="confirmar"></div>
        <div id="buscar"></div>
    <center>
        <div id="panelLinea" class="panel primary-celeste" style="background-color: #e7e7e7;width: 70%;margin: 0%">
            <div class="panel-heading centrado">Cajas | Detalle</div>
            <div class="panel-body">
                <form id="formLinea">
                    <div class="row">
                        <div class="col-md-1">
                            <span>Id Caja</span>
                        </div>
                        <!--div class="col-md-1">
                            <input id="id_detallecaja" name="id_detallecaja" type="text" class="fcontrolbordo input-sm" placeholder="Id" readonly="readonly">
                        </div-->
                        <div class="col-md-1">
                            <input id="id_caja" name="id_caja" type="text"
                                   class="fcontrolbordo imput-sm" placeholder="id">
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-1">
                            <span>Venta</span>
                        </div>
                        <div class="col-md-1">
                            <input id="id_venta" name="id_venta" type="text" class="fcontrolbordo input-sm" placeholder="Id">
                        </div>
                        <div class="col-md-1">
                            <button id="botonBuscarIdVenta" type="button" class="btn celeste celeste1 btn-sm"><span class="glyphicon glyphicon-search"></span></button>
                        </div>
                        <!--<div class="col-md-1">
                            <span> Factura Nº</span>
                        </div>
                        <div class="col-md-2">
                            <input id="numero_factura" name="numero_factura" type="text" class="fcontrolbordo input-sm" placeholder="nºfactura" readonly="readonly">
                        </div>-->
                        <div class="col-md-1">
                            <span> Total a Pagar</span>
                        </div>
                        <div class="col-md-2">
                            <input id="total" name="total" type="text" class="fcontrolbordo input-sm" placeholder="total" readonly="readonly">
                        </div>
                    </div> 
                    <hr>

                    <!-- INICIO DEL FORMA DE PAGO
                     <div class="row">
                         <div class="col-md-1">
                             <span>Id</span>
                         </div>
                         <div class="col-md-1">
                             <input id="id_pago" name="id_pago" type="text" class="fcontrolbordo input-sm" placeholder="Id">
                         </div>
                         <div class="col-md-1">
                             <button id="botonBuscarIdPago" type="button" class="btn celeste celeste1 btn-sm"><span class="glyphicon glyphicon-search"></span></button>
                         </div>
 
                         <div class="col-md-1">
                             <span>Forma de Pago</span>
                         </div>
                         <div class="col-md-2">
                             <input id="forma_pago" name="forma_pago" type="text" class="fcontrolbordo input-sm" placeholder="pago">
                         </div>
                         <div class="col-md-6">
                         </div>
                     </div>
                     FIN DEL FORMA DE PAGO*****************************************-->
                    <div class="row">
                        <div class="col-md-1">
                            <span>Id</span>
                        </div>
                        <div class="col-md-1">
                            <input id="id_pago" name="id_pago" type="text" class="fcontrolbordo input-sm" placeholder="Id">
                        </div>
                        <div class="col-md-1">
                            <button id="botonBuscarIdPago" type="button" class="btn azul azul1 btn-sm"><span class="glyphicon glyphicon-search"></span></button>
                        </div>

                        <div class="col-md-1">
                            <span>Forma de Pago</span>
                        </div>
                        <div class="col-md-2">
                            <input id="forma_pago" name="forma_pago" type="text" class="fcontrolbordo input-sm" placeholder="pago">
                        </div>
                        <div class="col-md-6">
                        </div>
                    </div>

                    <!--******************************************************* -->

                    <!--div class="row">
                        <div class="col-md-1">
                            <span>tipo factura</span>
                        </div>
                        <div class="col-md-2">
                            <select name="id_pago" id="id_tipo_factura" class="form-control input-sm" >
                                <option selected value="1">CONTADO</option>                              
                            </select>
                        </div>  
                        <div class="col-md-1">
                            <span>tipo pago</span>
                        </div>
                        <div class="col-md-2">
                            <select name="id_pago" id="id_pago" class="form-control input-sm" >                               
                                <option value="1">EFECTIVO</option> 

                            </select>
                        </div>
                    </div-->



                    <hr>
                    <div class="row">
                        <div class="col-md-1">
                            <span> Importe</span>
                        </div>
                        <div class="col-md-2">
                            <input id="importe_caja" name="importe_caja" type="text" class="fcontrolbordo input-sm" placeholder="importe" onkeypress="return soloNumeros(event)">
                        </div>

                        <div class="col-md-1">
                            <span> Vuelto</span>
                        </div>
                        <div class="col-md-2">
                            <input id="vuelto2" name="vuelto2" type="text" class="fcontrolbordo input-sm" placeholder="vuelto2" onkeypress="return soloNumeros(event)" style="">
                        </div>
                        <div class="col-md-6">
                        </div>
                    </div>

                </form>
            </div>
            <div class="panel-footer centrado">
                <button id="botonAgregarLinea" type="button" class="btn celeste celeste1 btn-sm">Confirmar</button>


                <!--button id="botonEliminarLinea" type="button" class="btn azul azul1 btn-sm" data-toggle="modal" data-target="#confirmarEliminarLinea">Eliminar</button-->
                <!--<button id="botonSalirLinea" type="button" class="btn celeste celeste1 btn-sm">Salir</button>-->
                <button id="botonSalir" type="button" class="btn celeste celeste1 btn-sm">Salir</button>
            </div>
        </div>
    </center>
    <script src="../../../js/jquery.min.js" type="text/javascript"></script>
    <script src="../../../js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../../js/funciones.js" type="text/javascript"></script>
    <script src="js/funciones.js" type="text/javascript"></script>
    <script>
                                verificarSesion(true);
                                /*function getGET()
                                 {
                                 
                                 var loc = document.location.href;
                                 
                                 if (loc.indexOf('?') > 0)
                                 {
                                 
                                 var getString = loc.split('?')[1];
                                 
                                 var GET = getString.split('&');
                                 var get = {};
                                 
                                 
                                 for (var i = 0, l = GET.length; i < l; i++) {
                                 var tmp = GET[i].split('=');
                                 get[tmp[0]] = unescape(decodeURI(tmp[1]));
                                 }
                                 return get;
                                 }
                                 }
                                 var valores = getGET();
                                 if (valores)
                                 {
                                 
                                 for (var index in valores)
                                 {
                                 
                                 $("#id_venta").val(valores[index]);
                                 }
                                 } else {
                                 }*/
                               // window.onload = alert(localStorage.getItem("id_venta"));
                                var id_recibido = localStorage.getItem("id_venta");
                                $("#id_venta").val(id_recibido);
                                //AQUI OBTENEMOS EL VALOR DEL ID_VENTA 

                                function getGET()
                                {

                                    var loc = document.location.href;

                                    if (loc.indexOf('?') > 0)
                                    {

                                        var getString = loc.split('?')[1];

                                        var GET = getString.split('&');
                                        var get = {};


                                        for (var i = 0, l = GET.length; i < 2; i++) {
                                            var tmp = GET[i].split('=');
                                            get[tmp[0]] = unescape(decodeURI(tmp[1]));
                                            //alert(get[tmp[0]]);
                                            if (i == 0) {
                                                document.getElementById('id_venta').value = get[tmp[0]];
                                            }
                                            if (i == 1) {
                                                document.getElementById('id_caja').value = get[tmp[0]];
                                            }
                                        }
                                        return get;
                                    }
                                }

                                window.onload = function ()
                                {

                                    var valores = getGET();
                                    if (valores)
                                    {

                                        for (var index in valores)
                                        {
                                            //document.write(valores[index]);
                                            //document.getElementById('id_venta').value = valores[index];
                                            //document.getElementById('id_caja').value = valores[index];
                                        }
                                    } else {


                                        document.write("<br>No se ha recibido ningún parámetro");
                                    }
                                    buscarIdVenta();
                                }


                               // buscarIdVenta();
                                $("#buscar").css("display", "none");
                                $("#id_tipo_factura").css("visibility", "hidden");
                                /*******************************/
                                //setTimeout('buscarIdCaja2()', 500);
                                $("#id_venta").focus();

                                //siguientecampo("#id_caja", "#nombre_caja", false);
                               
                                $("#id_caja").focusout(function (event) {
                                    if ($("#id_caja").val() === "") {
                                        $("#id_caja").val("0");
                                    }
                                    buscarIdCaja2();
                                    var id = $("#id_caja").val();
                                    $("#id_caja").val("0");

                                });

                                $("#botonBuscarIdCaja").on('click', function () {
                                    $("#buscar").load("buscar.html");
                                    $("#buscar").fadeIn("slow");
                                    $("#panelPrograma").fadeOut("slow");
                                });

                                /*$("#nombre_caja").focusout(function (event) {
                                 if ($("#nombre_caja").val() !== "") {
                                 buscarCaja();
                                 }
                                 
                                 });*/

                                $("#id_venta").focusout(function (event) {
                                    /*if ($("#id_venta").val() === "") {
                                     $("#id_venta").val("0");
                                     }
                                     buscarIdVenta();*/
                                    hidden();


                                });

                                $("#botonBuscarIdVenta").on('click', function () {
                                    $("#buscar").load("buscarVenta.html");
                                    $("#buscar").fadeIn("slow");
                                    $("#panelLinea").fadeOut("slow");
                                });
                                $("#vuelto2").focusout(function (event) {
                                    if ($("#vuelto2").val() !== "" || ($("#vuelto2").val() !== 0) && ($("#total").val() !== "") || ($("#total").val() !== 0)) {
                                        vuelto2(this);
                                    }
                                });


                                $("#botonAgregar").on('click', function () {
                                    if (validarFormulario()) {
                                        agregarCaja2();
                                    }
                                });

                                $("#botonAgregarLinea").on('click', function () {
                                    //if (validarFormularioCaja()) {
                                     
                                     agregarCajaDetalle2();
                                     
                                    // }
                                    var d = $("#id_venta").val();
                                    //var e = $("#id_caja").val();

                                    var jsp = "jsp/ticket.jsp";
                                    window.open(jsp + "?d=" + d);

                                });
                                $("#botonModificar").on('click', function () {
                                    //if(validarFormulario()) {
                                    modificarCaja();
                                    //}   
                                });
                                $("#botonEliminarAlert").on('click', function () {
                                    eliminarCaja();
                                    $('#confirmarEliminar').modal('hide');
                                });
                                $("#botonSalir").on('click', function () {
                                    location.href = "../ventas/index.html";
                                });

                                $("#botonSalirLinea").on('click', function () {
                                    $("#panelLinea").fadeOut("slow");
                                    $("#panelPrograma").fadeIn("slow");
                                });

                                $("#importe_caja").keyup(function (event) {

                                    vuelto2(this);

                                });

                                /*$("#id_tipo_factura").focusout(function (event) {
                                 if ($("#id_tipo_factura").val() === "") {
                                 $("#id_tipo_factura").val("0");
                                 }
                                 buscarIdTipo_factura();
                                 });
                                 $("#botonBuscarIdTipo_factura").on('click', function () {
                                 $("#buscar").load("buscarTipoFactura.html");
                                 $("#buscar").fadeIn("slow");
                                 $("#panelPrograma").fadeOut("slow");
                                 });
                                 
                                 
                                 /*$("#id_pago").focusout(function (event) {
                                 if ($("#id_pago").val() === "") {
                                 $("#id_pago").val("0");
                                 }
                                 buscarIdPagos();
                                 });
                                 
                                 
                                 $("#botonBuscarIdPago").on('click', function () {
                                 $("#buscar").load("buscarPagos.html");
                                 $("#buscar").fadeIn("slow");
                                 $("#panelPrograma").fadeOut("slow");
                                 });*/
                                $("#id_pago").focusout(function (event) {
                                    if ($("#id_pago").val() === "") {
                                        $("#id_pago").val("0");
                                    }
                                    buscarIdPagos2();
                                });
                                $("#botonBuscarIdPago").on('click', function () {
                                    $("#buscar").load("buscarPagos.html");
                                    $("#buscar").fadeIn("slow");
                                    $("#panelLinea").fadeOut("slow");
                                });




    </script>
</body>
</html>